<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptPay QR Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .settings-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .amount-section {
            margin-bottom: 25px;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .amount-btn {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .amount-btn:nth-child(1) { background: linear-gradient(135deg, #FF6B9D, #FE8E5B); }
        .amount-btn:nth-child(2) { background: linear-gradient(135deg, #FFA500, #FF6347); }
        .amount-btn:nth-child(3) { background: linear-gradient(135deg, #4ECDC4, #44A08D); }
        .amount-btn:nth-child(4) { background: linear-gradient(135deg, #667eea, #764ba2); }
        .amount-btn:nth-child(5) { background: linear-gradient(135deg, #F093FB, #F5576C); }
        .amount-btn:nth-child(6) { background: linear-gradient(135deg, #4facfe, #00f2fe); }

        .amount-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .amount-btn:active {
            transform: translateY(0);
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            margin-top: 10px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .qr-container {
            display: none;
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            background: #f8f9ff;
            border-radius: 20px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }

        #qrcode img {
            max-width: 100% !important;
            height: auto !important;
            width: 100% !important;
        }

        #qrcode canvas {
            max-width: 100% !important;
            height: auto !important;
            width: 100% !important;
        }

        .qr-info {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            font-size: 0.95em;
        }

        .qr-info p {
            margin: 8px 0;
            color: #555;
        }

        .qr-info strong {
            color: #667eea;
        }

        .error {
            color: #ff4757;
            background: #ffebee;
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
            text-align: center;
        }

        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.6em;
            }

            .quick-amounts {
                grid-template-columns: repeat(2, 1fr);
            }

            .amount-btn {
                padding: 18px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí≥ PromptPay QR</h1>
        <p class="subtitle">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>

        <div class="settings-section">
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
            <select id="accountType">
                <option value="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                <option value="id">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</option>
            </select>

            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
            <input type="text" id="accountNumber" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô">
        </div>

        <div class="amount-section">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πà‡∏ß‡∏ô</label>
            <div class="quick-amounts">
                <button class="amount-btn" onclick="setAmount(20)">20 ‡∏ø</button>
                <button class="amount-btn" onclick="setAmount(50)">50 ‡∏ø</button>
                <button class="amount-btn" onclick="setAmount(100)">100 ‡∏ø</button>
                <button class="amount-btn" onclick="setAmount(200)">200 ‡∏ø</button>
                <button class="amount-btn" onclick="setAmount(500)">500 ‡∏ø</button>
                <button class="amount-btn" onclick="setAmount(1000)">1,000 ‡∏ø</button>
            </div>

            <label>‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</label>
            <input type="number" id="amount" placeholder="‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)" step="0.01" min="0">
        </div>

        <button class="generate-btn" onclick="generateQR()">üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>

        <div class="error" id="error"></div>

        <div class="qr-container" id="qrContainer">
            <div id="qrcode"></div>
            <div class="qr-info" id="qrInfo"></div>
        </div>
    </div>

    <script>
        let qrcodeInstance = null;

        function setAmount(value) {
            document.getElementById('amount').value = value;
        }

        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                crc ^= data.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    if (crc & 0x8000) {
                        crc = (crc << 1) ^ 0x1021;
                    } else {
                        crc = crc << 1;
                    }
                }
            }
            crc &= 0xFFFF;
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }

        function generatePromptPayQR(accountNumber, amount = null) {
            // Format account number
            let formattedAccount = accountNumber.replace(/\D/g, '');
            
            // Build EMV QR Code
            let qrData = '';
            qrData += '000201'; // Payload Format Indicator
            qrData += '010212'; // Point of Initiation Method (12 = QR can be used multiple times)
            
            // Merchant Account Information
            let merchantInfo = '';
            merchantInfo += '0016' + 'A000000677010111'; // AID
            merchantInfo += '01' + (formattedAccount.length < 10 ? '13' : '15');
            merchantInfo += '00' + formattedAccount.length + formattedAccount;
            
            qrData += '29' + merchantInfo.length.toString().padStart(2, '0') + merchantInfo;
            
            qrData += '5802TH'; // Country Code
            
            // Transaction Amount
            if (amount && amount > 0) {
                let amountStr = parseFloat(amount).toFixed(2);
                qrData += '54' + amountStr.length.toString().padStart(2, '0') + amountStr;
            }
            
            qrData += '6304'; // CRC placeholder
            
            // Calculate and append CRC
            let checksum = crc16(qrData);
            qrData += checksum;
            
            return qrData;
        }

        function generateQR() {
            const accountType = document.getElementById('accountType').value;
            const accountNumber = document.getElementById('accountNumber').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const errorDiv = document.getElementById('error');
            
            // Validation
            errorDiv.style.display = 'none';
            
            if (!accountNumber) {
                errorDiv.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ';
                errorDiv.style.display = 'block';
                return;
            }

            const cleanNumber = accountNumber.replace(/\D/g, '');
            
            if (accountType === 'phone' && cleanNumber.length !== 10) {
                errorDiv.textContent = '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (accountType === 'id' && cleanNumber.length !== 13) {
                errorDiv.textContent = '‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 13 ‡∏´‡∏•‡∏±‡∏Å';
                errorDiv.style.display = 'block';
                return;
            }

            if (amount && (amount <= 0 || isNaN(amount))) {
                errorDiv.textContent = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                errorDiv.style.display = 'block';
                return;
            }

            // Generate PromptPay QR
            const qrString = generatePromptPayQR(cleanNumber, amount);
            
            // Clear previous QR code
            const qrcodeDiv = document.getElementById('qrcode');
            qrcodeDiv.innerHTML = '';
            
            // Generate new QR code
            new QRCode(qrcodeDiv, {
                text: qrString,
                width: 250,
                height: 250,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.L
            });
            
            // Show QR container
            const qrContainer = document.getElementById('qrContainer');
            qrContainer.style.display = 'block';
            
            // Update info
            const qrInfo = document.getElementById('qrInfo');
            const accountTypeText = accountType === 'phone' ? '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå' : '‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô';
            const maskedNumber = accountType === 'phone' 
                ? cleanNumber.substring(0, 3) + 'xxx' + cleanNumber.substring(6)
                : cleanNumber.substring(0, 1) + 'xxxx' + cleanNumber.substring(5, 8) + 'xxxxx' + cleanNumber.substring(12);
            
            qrInfo.innerHTML = `
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${accountTypeText}</p>
                <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç:</strong> ${maskedNumber}</p>
                ${amount ? `<p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${amount.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ‡∏ö‡∏≤‡∏ó</p>` : '<p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ (‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á)</p>'}
            `;
            
            // Scroll to QR code
            qrContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Allow Enter key to generate QR
        document.getElementById('accountNumber').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') generateQR();
        });
        
        document.getElementById('amount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') generateQR();
        });
    </script>
</body>
</html>
